# EOS.IO 技术白皮书 V2

**2018 年 3 月 16 日 (翻译：荆雷）**

**摘要：** EOS.IO 软件引入了一种新的区块链架构，该架构使得去中心化应用可以垂直和水平扩展性能。这是通过创建一个类似操作系统的架构，各类应用运行在这个系统之上达到的。软件提供了帐户、身份验证、数据库、异步通信以及在众多CPU或集群之间的调度功能。该技术最终会是一个最大能扩展到数百万次交易每秒，免除用户费用，并允许快捷地发布和维护去中心化应用的区块链架构，这一切都是在一个受治理的区块链环境中。

**请注意：本白皮书中所提到加密令牌是指在 EOS.IO 软件启动后的区块链上的令牌。而不是指之前在以太坊区块链上分发的 ERC-20 兼容 EOS 令牌。**

版权 © 2018 block.one


<!-- MarkdownTOC depth=4 autolink=true bracket=round list_bullets="-*+" -->

- [背景](#background)
- [区块链应用的要求](#requirements-for-blockchain-applications)
  * [支持数百万用户](#support-millions-of-users)
  * [免费使用](#free-usage)
  * [升级简单和缺陷修复](#easy-upgrades-and-bug-recovery)
  * [低延迟](#low-latency)
  * [串行性能](#sequential-performance)
  * [并行性能](#parallel-performance)
- [共识算法 (BFT-DPOS))](#consensus-algorithm-bft-dpos)
  * [交易确认](#transaction-confirmation)
  * [交易作为权益证明 (TaPoS)](#transaction-as-proof-of-stake-tapos)
- [帐户](#accounts)
  * [操作 & 处理](#actions--handlers)
  * [基于角色的权限管理](#role-based-permission-management)
    + [命名的权限级别](#named-permission-levels)
    + [权限映射](#permission-mapping)
    + [评估权限](#evaluating-permissions)
      - [默认权限群组](#default-permission-groups)
      - [权限并行评估](#parallel-evaluation-of-permissions)
  * [带强制性延时的操作](#actions-with-mandatory-delay)
  * [恢复被盗窃的密钥](#recovery-from-stolen-keys)
- [Deterministic Parallel Execution of Applications](#deterministic-parallel-execution-of-applications)
  * [Minimizing Communication Latency](#minimizing-communication-latency)
  * [Read-Only Action Handlers](#read-only-action-handlers)
  * [Atomic Transactions with Multiple Accounts](#atomic-transactions-with-multiple-accounts)
  * [Partial Evaluation of Blockchain State](#partial-evaluation-of-blockchain-state)
  * [Subjective Best Effort Scheduling](#subjective-best-effort-scheduling)
  * [Deferred Transactions](#deferred-transactions)
  * [Context Free Actions](#context-free-actions)
- [Token Model and Resource Usage](#token-model-and-resource-usage)
  * [Objective and Subjective Measurements](#objective-and-subjective-measurements)
  * [Receiver Pays](#receiver-pays)
  * [Delegating Capacity](#delegating-capacity)
  * [Separating Transaction costs from Token Value](#separating-transaction-costs-from-token-value)
  * [State Storage Costs](#state-storage-costs)
  * [Block Rewards](#block-rewards)
  * [Worker Proposal System](#worker-proposal-system)
- [Governance](#governance)
  * [Freezing Accounts](#freezing-accounts)
  * [Changing Account Code](#changing-account-code)
  * [Constitution](#constitution)
  * [Upgrading the Protocol & Constitution](#upgrading-the-protocol--constitution)
    + [Emergency Changes](#emergency-changes)
- [Scripts & Virtual Machines](#scripts--virtual-machines)
  * [Schema Defined Actions](#schema-defined-actions)
  * [Schema Defined Database](#schema-defined-database)
  * [Generic Multi Index Database API](#generic-multi-index-database-api)
  * [Separating Authentication from Application](#separating-authentication-from-application)
- [Inter Blockchain Communication](#inter-blockchain-communication)
  * [Merkle Proofs for Light Client Validation \(LCV\)](#merkle-proofs-for-light-client-validation-lcv)
  * [Latency of Interchain Communication](#latency-of-interchain-communication)
  * [Proof of Completeness](#proof-of-completeness)
  * [Segregated Witness](#segregated-witness)
- [Conclusion](#conclusion)

<!-- /MarkdownTOC -->

# 背景

区块链技术随着 2008 年比特币的发行得以被认知，从那之后创业者和开发者就不断的尝试推广这一技术，以便在单一的区块链平台上支持更为广泛的应用程序。

当一些区块链平台吃力的支持勉强可用的去中心化应用，应用化的区块链比如 BitShares 去中心化交易所 (2014) 和 Steem 社交媒体平台 (2016) 已经成为每天被成千上万的日活用户重度使用的区块链。 他们能做到这些，是通过提升性能到每秒处理上千笔交易，降低延迟到1.5秒，消除每笔交易的手续费和提供堪比现有的中心化服务的用户体验。

现有的区块链平台被大额使用费和有限的计算能力拖累，它们也阻碍了区块链的大范围推广。

# 区块链应用的要求

为了赢得广泛的应用，区块链上的应用需要一个足够灵活得以满足以下要求的平台：

## 支持成百上千的用户

要与 Ebay、Uber、AirBnB 和 Facebook 这样企业竞争，需要区块链技术能处理数千万的日活用户。 在某些情况下，除非用户群体达到一定量级否则应用并不会起多大作用，因此一个可以处理庞大用户的平台是至关重要的。

## 免费使用

应用开发人员需要一定的灵活性以便为户提供免费服务；用户不需要必须为使用该平台或从其服务中受益而支付费用。一个给用户免费使用的区块链平台将可能获得更广泛的认可。开发者和企业然后可以建立有效的盈利策略。


## 升级简单和缺陷修复

企业构建基于区块链的应用需要能够为应用增加新特性的灵活性。平台必须支持软件和智能合约的升级。

所有非同简单的软件都会受到缺陷的影响，即便是经过了最严格的形式验证。这个平台必须在缺陷不可避免出现时足够健壮到可修复。

## 低延时

一个好的用户体验要求不超过数秒延迟的可靠反馈。 高延时会使用户感到灰心，并且会让构建在区块链上的应用比已有的非区块链应用缺乏竞争力。平台应该支持低延时交易。

## 串行性能

有些应用因为有依赖有先后关系的步骤而不能使用并行算法实现。比如交易所这样的应用就需要足够的串行性能来处理很高的交易量。因此平台应该支持高串行性能。

## 并行性能

大型应用需要将工作分配到多个 CPU 和计算机。


# 共识算法 (BFT-DPOS)
EOS.IO 软件使用唯一已知能满足区块链上的应用性能需求的去中心化共识算法，委托股权证明 (DPOS)。在这种算法之下，那些 EOS 区块链令牌持有者可以通过持续验证的投票系统选举区块生产者。任何人都可以选择参与区块生产，如果他们能够说服令牌持有人投票给他们，将会被给予生产区块的机会。

EOS.IO 软件能够每 0.5 秒精确地生产一个区块，并且刚好一个生产者被授权在给定的时间点生产一个区块。如果在预定时间内区块没有生成，则这个时间段的区块被跳过。当一个或多个区块被跳过时，区块链中会存在0.5秒或者更多时间的间隔。

使用 EOS.IO 软件，区块被以 126 轮进行生成（每人6个区块，乘以21个生产者）。在每轮开始时，根据令牌持有者的投票选出21个不同的块生产者。获选生产者的生产顺序由15个及以上的生产者约定安排。

如果一个生产者错过了一个区块并且在过去的 24 小时内没有生产任何区块，那么他们将被从候选中移除，直到他们通知区块链他们要开始再次生产区块。 这样通过最小化那些被证实的不稳定节点非计划性错过生成的区块数量来确保网络运行流畅。

在通常情况下，一个 DPOS 区块链不会经历任何的分叉，因为区块生产者是通过合作而非竞争的方式来生产区块。 即使出现了分叉，共识也会自动的切换到最长的链上。 这种方式之所以有效，是因为区块添加到一个区块链分叉的速率与公用同一共识的区块生产者比例是相关的。 换句话说，具有更多生产者的区块链分叉会比拥有较少生产者的那一条链区块长度增长的速度更快，因为拥有更多生产者就会经历更少的错失区块。

而且，没有一个生产者会在两个分叉上同时生成区块。如果一个区块生产者被抓到这样做，那么这个生产者将可能被投票投出。凭借双重生产的密码学证据就可以自动剔除这类滥用者。

通过允许所有生产者来签名所有区块，只要没有生产者使用相同的时间错或者相同的区块高度签名两个区块，拜占庭容错机制被加入到了传统的 DPOS 中。一旦 15 个生产者签署了一个区块，这个区块就不再可逆了。任何使用相同时间戳或相同区块高度的拜占庭生产者将不得不生成他们叛变的密码学凭证。在这个模式下，一个不可逆的共识应该在 1 秒内达成。

## 交易确认

通常 DPOS 区块链会有百分之百的区块生产者参与。一个交易从广播开始平均 0.25 秒后就有 99.9% 的确定性被认为是确认可信的。
另外对于 DPOS，为了达成更快的不可逆性，EOSIO 加入了异步拜占庭容错（aBFT）。异步拜占庭容错算法提供了在一秒内百分之一百的不可逆性确认。

## 交易作为权益证明 (TaPoS)

EOS.IO 软件要求每一个交易包含最近一个区块头的部分哈希值。这个哈希值有两个目的：

  1. 防止在不包含引用区块的分叉上交易重放；和
  2. 通知网络某位用户和他们的权益在某个分叉上。

经过一段时间，所有用户最终都直接确认区块链，这样就使得难以伪造假链，因为假链不能从合法链上迁移交易。

# 帐户

EOS.IO 软件允许所有的帐户使用一个唯一的人类易读的名称，名称长度以 12 个字符为上限。 这个名称由帐户创建者自己选择。 帐户创建者必须预留必要的内存来保存这个新账号，直到新账号付钱保留它自己的内存。

在一个去中心化的场景中，为了注册一个新用户，应用开发者将会为创建账号支付一点微不足道的成本。传统商业已经在广告，免费服务等等之上花费不菲来获取用户。相较而言，创建一个新区块链账号的成本应该微不足道。幸运的是，一个已经在其他应用注册过的用户不再需要创建新的帐户。


## 操作 & 处理

